#链路状态协议(OSPF and IS-IS)

##矢量基本概念
RIB:可达目的地址的数据库；创建RIB的机制：路由器之间交流目的地址及其关联信息的程序；到目的地最短路径的算法。
路由器学习前缀有三种方式：目的前缀与路由器接口关联；手动配置；从其它路由协议；
EIGRP路由：非周期性更新；维护拓扑表；
 |--(5)--B--(15)----X
A|--(7)--C--(18)----X
 |--(2)--D--(25)----X
 A到X有三条路径，A会选择B路由器到X，因为cost为最小，会选择C为feasible successor,因为C通告的X的cost为18，小于20。D则不符合条件，不是feasible successor。
 如果C路由器失效了，A通过B到达X也失效了，A就给每个下游路由器（D）发送查询消息关于到X的路由，D如果有关于X的feasible successor，则回复消息该路由消息，否则
 继续给下游路由器发送查询消息。直至eigrp domian边界，并返回empty。这种方式在大型网络中带来两个弊端：1）查询时间过长，导致收敛慢；2）如果查询路由器
 及时得不到回复，会导致查询路由器以为邻居路由器stuck in active (SIA)，查询路由器会清除该邻居关系，并丢弃从该邻居学习到的路由。解决该问题的方法有
 两个：1）增加查询路由器消息时间；2）将eigrp网络分为多个进程，缩小一个进程的网络规模。
 
 ##链路状态基本
 路由信息先传递后计算，每个路由器进行独立的本地计算，计算结果不会分享给邻居。
 链路状态协议的特点：1）路由器在每个链路上发送和侦听hello报文，用于发现邻居 2）对外宣告自身、链路和邻居信息 3）路由器收到宣告之后在数据库中保存一份
 副本，然后通告给下游路由器 4）收到所有的宣告之后，开始计算路由。
 邻居：可以使用同一种协议进行路由交换的路由器。
 Hello 消息：包含路由器ID，发送时间，接口信息，认证信息等。为了保证hello消息不超出本地链路，可以设置hello消息的TTL为1或者使用组播地址。使用握手机制。
 Flood：
  1）Timely Flooding:aging：每个flood里面给age字段设置一个值，这个值增大或减小到阈值，该报文就超时，被删除。
  2）Sequential Flooding:Sequence Numbers：使用棒棒糖机制，无限循环使用；如果路由器重启或者内存丢失，路由器发送初始序列号的报文给邻居后，邻居路由器里面有该路由器最近
 发送的报文的序列号，然后会发一份给该路由器，该路由器重新使用之前的序列号（+1）重新发送报文。
  3）Reliable Flooding: Checksums，不包括age字段。
 Announcement Headers：包含标识字段、sequence number, age, and checksum等。
 Database Synchronization：由于数据库是相同的，新上线的路由器无须让其他路由器重新发送通告报文，只需要和邻居路由器的数据库进行同步就可以了。
 Areas: 1)每个区域有相同的数据库 2）只可以在同一个区域flood。
 
 ##Message type
 ###术语
  标识路由器:OSPF用Router-id;IS-IS用System-id
  链路状态：OSPF用LSA;IS-IS用LSP
  分层：OSPF用backbone area和nonbackbone area;IS-IS用level-1和level-2
 ###消息封装
  OSPF:通过网络层，IP协议号89；组播或单播，组播地址：224.0.0.5 and 224.0.0.6；
  IS-IS:通过链路层；组播或单播，组播地址：0180:c200:0014 or 0180:c200:0015；
  安全：OSPF使用IP协议，容易受到DDOS等攻击；IS-IS使用链路层协议，安全性较好；
  Qos：OSPF可以在包头中设置高优先级，保证包的快速传递；IS-IS不使用IP协议，需要厂商使用私有的机制来保证；
 ###消息架构
  OSPF:使用固定的32bit，不利于扩展；
  IS-IS：可以根据type/length/value（TLV）进行扩展，0-254字节；
 ###消息类型
  OSPF:hello,Database Description (DD),Link State Request;Link State Acknowledgement;Link State Update
  IS-IS:IS-IS Hello (IIH,分为L1，L2和P2P子类),Complete Sequence Number PDU (CSNP，分为L1，L2子类),Partial Sequence Number PDU (PSNP，分为L1，L2子类),Link State PDU (LSP，分为L1，L2子类)

##Addressing, Neighbor Discovery, and Adjacencies
###OSPF Router and Area ID
 OSPF的Router ID:32bit,必须配置，且唯一，选择方式：手动配置>loopback 地址>物理接口地址>
 OSPF的Area ID:32bit,骨干区域为0，其余为非骨干区域。
###IS-IS Router and Area ID
 IS-IS的Router id和area id通过Network Entity Title(NET)配置在一起，用16进制表示，NET分为四个部分：
  AFI:1字节，在IP网络中作为area id的一部分
  Area ID:0-12 字节
  Sys ID:6字节
  SEL:1字节，标识上层协议，在路由器上值为0x00
 建议：
  Area id:
   使用AFI表示NET：05.00d0.b775.ff31.00，area id：05
   使用NSAP表示NET：49.0005.00d0.b775.ff31.00，area id：0005，49为本地AFI地址


  
  



   
  
 
 
